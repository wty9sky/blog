<!DOCTYPE html><html> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Vue3源码解析-目录结构&amp;模块依赖</title><link rel="icon" type="image/vnd.microsoft.icon" href="/favicon.ico"><link rel="sitemap" href="/sitemap-index.xml"><title>Vue3源码解析-目录结构&模块依赖</title><link rel="canonical" href="https://wty9sky.github.io/blog/detail/9/"><meta name="description" content="Vue3源码解析-目录结构&#38;模块依赖"><meta name="robots" content="index, follow"><meta property="og:title" content="Vue3源码解析-目录结构&#38;模块依赖"><meta property="og:type" content="article"><meta property="og:image" content="/og.svg"><meta property="og:url" content="https://wty9sky.github.io/blog/detail/9/"><meta property="og:locale" content="zh_CN"><meta property="og:locale:alternate" content="zh_TW"><meta property="og:locale:alternate" content="en_US"><meta property="og:site_name" content="9Sky 九天"><link rel="shortcut icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/avatar.png"><meta name="generator" content="Astro v4.16.8"><meta name="keywords" content="详情"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/about.zJyvFudD.css">
<link rel="stylesheet" href="/_astro/about.DaaC2zNV.css"><script type="module" src="/_astro/hoisted.HO6_Fzad.js"></script></head> <body> <header class="header"> <h5 class="header__heading"> <a href="/" class="link">9Sky 九天</a> <span>
/
<a href="/blog" class="link"> 博客 </a> </span><span>
/
Vue3源码解析-目录结构&amp;模块依赖 </span> </h5> </header> <div id="navbar-sentinal"></div> <nav class="navbar" id="navbar-wrapper"> <div class="navbar__content"> <h5 class="navbar__path"> <a href="/" class="link">9Sky 九天</a> <span>
/
<a href="/blog" class="link"> 博客 </a> </span><span>
/
Vue3源码解析-目录结构&amp;模块依赖 </span> </h5> <div class="navbar__menu"> <ul data-astro-cid-tfcnbjmv> <li data-astro-cid-tfcnbjmv> <a class="link" href="/" data-astro-cid-tfcnbjmv> <i class="ri-home-line" data-astro-cid-tfcnbjmv></i>
主页
</a> </li> <li data-astro-cid-tfcnbjmv> <a class="link" href="/blog" data-astro-cid-tfcnbjmv> <i class="ri-newspaper-line" data-astro-cid-tfcnbjmv></i> 文章 </a> </li><li data-astro-cid-tfcnbjmv> <a class="link" href="/projects" data-astro-cid-tfcnbjmv> <i class="ri-server-line" data-astro-cid-tfcnbjmv></i> 项目 </a> </li><li data-astro-cid-tfcnbjmv> <a class="link" href="/lab" data-astro-cid-tfcnbjmv> <i class="ri-server-line" data-astro-cid-tfcnbjmv></i> 实验室 </a> </li><li data-astro-cid-tfcnbjmv> <a class="link" href="/about" data-astro-cid-tfcnbjmv> <i class="ri-cup-line" data-astro-cid-tfcnbjmv></i> 关于 </a> </li> </ul>  </div> </div> </nav> <script>
  // 使用 ViewTransition 后，所有 DOM 操作的 js 都有一堆问题
  // 这里用了极不优雅的 var，有待改进
  var observer;
  function addNavObserver() {
    const headerEl = document.querySelector("#navbar-wrapper");
    const sentinalEl = document.querySelector("#navbar-sentinal");
    if (!sentinalEl || !headerEl) return;
    observer = new window.IntersectionObserver((e) => {
      if (!e[0].isIntersectin && e[0].boundingClientRect.top <= 0) {
        headerEl.classList.add("navbar--sticked");
      } else {
        headerEl.classList.remove("navbar--sticked");
      }
    });
    observer.observe(sentinalEl);
  }

  function removeNavObserver() {
    if (observer) observer.disconnect();
    observer = null;
  }

  document.addEventListener(
    "astro:page-load",
    () => {
      addNavObserver();
    },
    { once: false },
  );

  document.addEventListener(
    "astro:before-swap",
    () => {
      removeNavObserver();
    },
    { once: false },
  );
</script>  <main class="page"> <section class="page__section page__section--at-top"> <!-- {
        article.cover && (
          <a href={article.cover} data-fancybox data-caption={article.title}>
            <img
              src={article.cover}
              alt={article.title}
              title={article.title}
              class="page__cover mb-8"
            />
          </a>
        )
      } --> <h1 class="page__heading">Vue3源码解析-目录结构&amp;模块依赖</h1> <p class="page__meta"> <i class="ri-calendar-line"></i> <span>2023 年 6 月 7 日 13:50</span> </p> <hr class="page__divide"> <article class="content"> <h2><a id="文章目录" class="content__heading-anchor"></a>文章目录</h2>
<ul>
<li><a href="#vue3-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E4%B8%8E%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96">Vue3 源码解读-目录结构与项目依赖</a>
<ul>
<li><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">目录结构</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%9B%BE">模块依赖关系图</a></li>
<li><a href="#%E7%89%88%E6%9C%AC%E6%9E%84%E5%BB%BA">版本构建</a></li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul></li>
</ul>
<h1><a id="vue3-源码解读-目录结构与项目依赖" class="content__heading-anchor"></a>Vue3 源码解读-目录结构与项目依赖</h1>
<h2><a id="目录结构" class="content__heading-anchor"></a>目录结构</h2>
<p>clone 源代码到本地后，在终端执行 tree -aI &quot;.git*|.vscode&quot; -C -L 2 获取目录结构。</p>
<blockquote>
<p>tree: 这是调用 tree 程序的命令，它以图形方式显示目录结构。<br><br>
a: 显示所有文件和目录，包括以点（.）开头的隐藏文件。<br><br>
I &quot;.git*|.vscode&quot;: 忽略列表，不显示与提供的模式匹配的文件或目录。在这个例子中，它会忽略所有以 .git 开头的文件和目录，以及 .vscode 目录。<br><br>
C: 在输出中启用颜色，以区分不同类型的文件。<br><br>
L 2: 限制目录树的显示深度为 2 层。<br></p>
</blockquote>
<p>得到如下目录结构：</p>
<pre><code>├── .eslintrc.cjs // eslint 代码风格检查工具的配置文件
├── .prettierignore // Pretttier 格式化工具忽略文件的配置文件
├── .prettierrc // Pretttier 格式化工具配置文件
├── BACKERS.md // 支持者列表
├── CHANGELOG.md // 代码版本变更日志
├── LICENSE // 软件许可证，vue3 遵循 The MIT License (MIT)协议
├── README.md // 本项目说明
├── SECURITY.md // 安全相关信息说明
├── changelogs // 存放版本变更日志的文件夹
│ ├── CHANGELOG-3.0.md
│ ├── CHANGELOG-3.1.md
│ └── CHANGELOG-3.2.md
├── netlify.toml // Netlify 部署工具的配置文件
├── package.json // 项目依赖和脚本的配置文件
├── packages
│ ├── compiler-core // 编译器核心，独立于平台
│ ├── compiler-dom // 针对浏览器的 DOM 模板编译器
│ ├── compiler-sfc // 单文件组件(.vue)编译器的实现
│ ├── compiler-ssr // 服务端渲染编译器的实现
│ ├── dts-test // TypeScript 类型声明测试
│ ├── global.d.ts // 全局 TypeScript 类型声明文件
│ ├── reactivity // 响应式系统的实现
│ ├── reactivity-transform // 实验性代码，会在 3.4 中从 Vue 核心中删除
│ ├── runtime-core // 运行时核心实例相关代码
│ ├── runtime-dom // 针对浏览器的运行时实现
│ ├── runtime-test // 运行时测试相关代码
│ ├── server-renderer // 服务端渲染的实现
│ ├── sfc-playground // 单文件组件在线调试器
│ ├── shared // package 之间共享的工具库
│ ├── template-explorer // 模板代码在线编译器
│ ├── vue // vue 编译后 dist 产物，不同场景的引入文件
│ └── vue-compat // 兼容旧版 API 的代码
├── pnpm-lock.yaml // pnpm 包管理器的依赖锁定文件
├── pnpm-workspace.yaml // pnpm 包管理器的工作区配置文件
├── rollup.config.js // Rollup 打包工具的配置文件
├── rollup.dts.config.js // Rollup 打包工具用于生成 TypeScript 类型声明文件的配置文件
├── scripts // 存放脚本文件的文件夹
│ ├── aliases.js
│ ├── build.js
│ ├── const-enum.js
│ ├── dev.js
│ ├── pre-dev-sfc.js
│ ├── release.js
│ ├── setupVitest.ts
│ ├── size-report.ts
│ ├── usage-size.ts
│ ├── utils.js
│ └── verifyCommit.js
├── tsconfig.build.json // 用于编译打包后的代码的 TypeScript 配置文件
├── tsconfig.json // 项目 TypeScript 配置文件
├── vitest.config.ts // Vitest 测试工具的基础配置文件
├── vitest.e2e.config.ts // Vite 测试工具的端到端测试配置文件
└── vitest.unit.config.ts // Vite 构建工具的单元测试配置文件
</code></pre>
<h2><a id="模块依赖关系图" class="content__heading-anchor"></a>模块依赖关系图</h2>
<p>Vue3 源码都放在 packages 目录下。</p>
<pre><code>├── packages
│ ├── compiler-core // 编译器核心，独立于平台
│ ├── compiler-dom // 针对浏览器的 DOM 模板编译器
│ ├── compiler-sfc // 单文件组件(.vue)编译器的实现
│ ├── compiler-ssr // 服务端渲染编译器的实现
│ ├── dts-test // TypeScript 类型声明测试
│ ├── global.d.ts // 全局 TypeScript 类型声明文件
│ ├── reactivity // 响应式系统的实现
│ ├── reactivity-transform // 实验性代码，会在 3.4 中从 Vue 核心中删除
│ ├── runtime-core // 运行时核心实例相关代码
│ ├── runtime-dom // 针对浏览器的运行时实现
│ ├── runtime-test // 运行时测试相关代码
│ ├── server-renderer // 服务端渲染的实现
│ ├── sfc-playground // 单文件组件在线调试器
│ ├── shared // package 之间共享的工具库
│ ├── template-explorer // 模板代码在线编译器
│ ├── vue // vue 编译后 dist 产物，不同场景的引入文件
│ └── vue-compat // 兼容旧版 API 的代码
</code></pre>
<h2><a id="版本构建" class="content__heading-anchor"></a>版本构建</h2>
<p>可以通过以下命令进行构建，构建出 Vue3 所有的版本<br>
npm run build</p>
<p>构建好的文件在目录: core\packages\vue\dist，生成的文件有:</p>
<ul>
<li>cjs（用于服务端渲染）
<ul>
<li>vue.cjs.js</li>
<li>vue.cjs.prod.js（生产版，代码进行了压缩）</li>
</ul></li>
<li>global（用于浏览器 script 标签导入，导入之后会增加一个全局的 Vue 对象）
<ul>
<li>vue.global.js</li>
<li>vue.global.prod.js（生产版，代码进行了压缩，包含编译器）</li>
<li>vue.runtime.global.js</li>
<li>vue.runtime.global.prod.js（生产版，代码进行了压缩）</li>
</ul></li>
<li>browser（用于支持 ES 6 Modules 浏览器 script 标签中 type 为 module 的情况下导入）
<ul>
<li>vue.esm-browser.js</li>
<li>vue.esm-browser.prod.js（生产版，代码进行了压缩，包含编译器）</li>
<li>vue.runtime.esm-browser.js</li>
<li>vue.runtime.esm-browser.prod.js（生产版，代码进行了压缩）</li>
</ul></li>
<li>bundler（这两个版本没有打包所有的代码，只会打包使用的代码，需要配合打包工具来使用，会<br>
让 Vue 体积更小）
<ul>
<li>vue.esm-bundler.js</li>
<li>vue.runtime.esm-bundler.js</li>
</ul></li>
</ul>
<h2><a id="总结" class="content__heading-anchor"></a>总结</h2>
<ul>
<li>Vue3 的源码采用 pnpm 实现 monorepo 管理的方式，这种方式可以将不同的功能模块分开管理，使得代码更加结构化和可维护。好处如下：</li>
<li>模块化: 代码按功能划分成不同的模块，便于管理和维护。</li>
<li>清晰的职责划分: 每个模块有明确的功能和职责，使得代码更加清晰和易于理解。</li>
<li>可维护性: 模块化的代码结构有助于定位问题和快速开发新功能。</li>
<li>可重用性: 独立的模块可以在不同的环境或项目中重用。</li>
<li>易于测试: 模块化的结构使得编写和运行单元测试更加容易。</li>
<li>优化打包: 通过模块化，现代打包工具可以更好地进行树摇（tree-shaking）等优化，减少最终构建的体积。</li>
<li>TypeScript 支持: Vue 3 使用 TypeScript 编写，模块化有助于提供类型安全和更好的开发体验。</li>
</ul>
 </article> </section> </main>  <footer class="footer"> <hr class="footer__divide"> <div class="footer__row"> <p class="m-2">
&#169; 2017-2024 <a href="/" class="link">9Sky 九天</a> </p> <div class="m-2"> <ul data-astro-cid-tfcnbjmv> <li data-astro-cid-tfcnbjmv> <a class="link" href="/" data-astro-cid-tfcnbjmv> 
主页
</a> </li> <li data-astro-cid-tfcnbjmv> <a class="link" href="/blog" data-astro-cid-tfcnbjmv>  文章 </a> </li><li data-astro-cid-tfcnbjmv> <a class="link" href="/projects" data-astro-cid-tfcnbjmv>  项目 </a> </li><li data-astro-cid-tfcnbjmv> <a class="link" href="/lab" data-astro-cid-tfcnbjmv>  实验室 </a> </li><li data-astro-cid-tfcnbjmv> <a class="link" href="/about" data-astro-cid-tfcnbjmv>  关于 </a> </li> </ul>  </div> </div> </footer> </body></html> 