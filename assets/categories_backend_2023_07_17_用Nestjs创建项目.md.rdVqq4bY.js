import{_ as p}from"./chunks/ArticleMetadata.kKKHCUbl.js";import{_ as k,p as e,a as r,v as d,C as g,e as n,y as A,f as o,o as t,q as y,s as D}from"./chunks/framework.x10tvMrD.js";import"./chunks/theme.7ewG0JCy.js";import"./chunks/index.w40geAFS.js";const O=JSON.parse('{"title":"Nestjså¿«é€Ÿä¸Šæ‰‹","description":"","frontmatter":{"title":"Nestjså¿«é€Ÿä¸Šæ‰‹","aside":true,"editLink":false,"lastUpdated":false,"showComment":false},"headers":[],"relativePath":"categories/backend/2023/07/17/ç”¨Nestjsåˆ›å»ºé¡¹ç›®.md","filePath":"categories/backend/2023/07/17/ç”¨Nestjsåˆ›å»ºé¡¹ç›®.md","lastUpdated":1706697925000}'),C={name:"categories/backend/2023/07/17/ç”¨Nestjsåˆ›å»ºé¡¹ç›®.md"},c=n("h1",{id:"nestjs-å¿«é€Ÿä¸Šæ‰‹",tabindex:"-1"},[A("Nestjs å¿«é€Ÿä¸Šæ‰‹ "),n("a",{class:"header-anchor",href:"#nestjs-å¿«é€Ÿä¸Šæ‰‹","aria-label":'Permalink to "Nestjs å¿«é€Ÿä¸Šæ‰‹"'},"â€‹")],-1),F=o(`<p><strong>NestJS</strong> æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„ <strong>Node.js</strong> æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚å®ƒé‡‡ç”¨äº†æ¸è¿›å¼ <strong>JavaScript</strong> ï¼Œä½¿ç”¨ <strong>TypeScript</strong> æ„å»ºå¹¶å®Œå…¨æ”¯æŒ <strong>TypeScript</strong>ï¼ˆä½†ä»å…è®¸å¼€å‘äººå‘˜ä½¿ç”¨çº¯<strong>JavaScript</strong> ç¼–ç ï¼‰ï¼Œå¹¶ç»“åˆäº†<strong>OOP</strong>ï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ã€<strong>FP</strong>ï¼ˆé¢å‘å‡½æ•°ç¼–ç¨‹ï¼‰å’Œ <strong>FRP</strong>ï¼ˆé¢å‘å‡½æ•°çš„å“åº”å¼ç¼–ç¨‹ï¼‰çš„å…ƒç´ ã€‚</p><h2 id="å¿«é€Ÿåˆ›å»ºé¡¹ç›®" tabindex="-1">å¿«é€Ÿåˆ›å»ºé¡¹ç›® <a class="header-anchor" href="#å¿«é€Ÿåˆ›å»ºé¡¹ç›®" aria-label="Permalink to &quot;å¿«é€Ÿåˆ›å»ºé¡¹ç›®&quot;">â€‹</a></h2><p>å…¨å±€å®‰è£…è„šæ‰‹æ¶å¹¶å¯ç”¨ä¸¥æ ¼æ¨¡å¼åˆ›å»ºé¡¹ç›®ï¼›</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">## å…¨å±€å®‰è£…è„šæ‰‹æ¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">npm i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">g @nestjs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">cli</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">## å¯ç”¨ Typescript ä¸¥æ ¼æ¨¡å¼åˆ›å»ºé¡¹ç›®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">nest new project </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">strict</span></span></code></pre></div><h2 id="ç†Ÿæ‚‰å…³é”®æ–‡ä»¶" tabindex="-1">ç†Ÿæ‚‰å…³é”®æ–‡ä»¶ <a class="header-anchor" href="#ç†Ÿæ‚‰å…³é”®æ–‡ä»¶" aria-label="Permalink to &quot;ç†Ÿæ‚‰å…³é”®æ–‡ä»¶&quot;">â€‹</a></h2><p><code>src</code>ç›®å½•æ˜¯ä¸»è¦çš„æºç ç›®å½•ï¼Œä¸»è¦ç”±å…¥å£æ–‡ä»¶ <code>main.ts</code> å’Œ ä¸€ç»„ <code>module</code>ï¼Œ<code>service</code>ï¼Œ<code>controller</code>æ„æˆã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>project</span></span>
<span class="line"><span>â”œâ”€ src</span></span>
<span class="line"><span>â”‚  â”œâ”€ app.controller.ts		     # ä¸šåŠ¡æ•°æ®äº¤äº’çš„å…¥å£ï¼Œå®ç°æ•°æ®åœ¨å‰åç«¯çš„äº¤äº’</span></span>
<span class="line"><span>â”‚  â”œâ”€ app.service.ts           # å°è£…ä¸šåŠ¡é€»è¾‘ï¼Œå°†é‡å¤çš„ä¸šåŠ¡é€»è¾‘åœ¨æœåŠ¡å±‚è¿›è¡Œå°è£…</span></span>
<span class="line"><span>â”‚  â”œâ”€ app.module.ts            # è´Ÿè´£æ¨¡å—çš„ç®¡ç†ï¼Œé€šå¸¸ app.module è´Ÿè´£å…¨å±€æ¨¡å—çš„ç®¡ç†</span></span>
<span class="line"><span>â”‚  â””â”€ main.ts                  # å…¥å£æ–‡ä»¶ï¼Œåˆ›å»ºåº”ç”¨å®ä¾‹</span></span>
<span class="line"><span>â”œâ”€ README.md</span></span>
<span class="line"><span>â”œâ”€ nest-cli.json</span></span>
<span class="line"><span>â”œâ”€ package.json</span></span>
<span class="line"><span>â”œâ”€ tsconfig.build.json</span></span>
<span class="line"><span>â””â”€ tsconfig.json</span></span></code></pre></div><h2 id="è¿è¡Œåº”ç”¨ç¨‹åº" tabindex="-1">è¿è¡Œåº”ç”¨ç¨‹åº <a class="header-anchor" href="#è¿è¡Œåº”ç”¨ç¨‹åº" aria-label="Permalink to &quot;è¿è¡Œåº”ç”¨ç¨‹åº&quot;">â€‹</a></h2><ol><li>æ™®é€šå¯åŠ¨æ¨¡å¼ï¼š<code>npm run start</code></li><li>ç›‘å¬å¯åŠ¨æ¨¡å¼ï¼š<code>npm run start:dev</code></li><li>è°ƒè¯•å¯åŠ¨æ¨¡å¼ï¼š<code>npm run start:debug</code></li></ol><h2 id="ä»æ¨¡å—ç®¡ç†å¼€å§‹" tabindex="-1">ä»æ¨¡å—ç®¡ç†å¼€å§‹ <a class="header-anchor" href="#ä»æ¨¡å—ç®¡ç†å¼€å§‹" aria-label="Permalink to &quot;ä»æ¨¡å—ç®¡ç†å¼€å§‹&quot;">â€‹</a></h2><p><strong>Nestjs</strong> æ˜¯å…¸å‹çš„é‡‡ç”¨æ¨¡å—åŒ–ç»„ç»‡åº”ç”¨ç»“æ„çš„æ¡†æ¶ï¼Œé€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªåº”ç”¨ç”±ä¸€ä¸ªæ ¹æ¨¡å—(<strong>Application Module</strong>)å’Œå¤šä¸ªåŠŸèƒ½æ¨¡å—å…±åŒç»„æˆã€‚</p><h3 id="åˆ›å»ºæ¨¡å—" tabindex="-1">åˆ›å»ºæ¨¡å—ï¼š <a class="header-anchor" href="#åˆ›å»ºæ¨¡å—" aria-label="Permalink to &quot;åˆ›å»ºæ¨¡å—ï¼š&quot;">â€‹</a></h3><ul><li>å®Œæ•´å‘½ä»¤ï¼š<code>nest generate module &lt;module-name&gt;</code></li><li>ç®€å†™å‘½ä»¤ï¼š<code>nest g mo &lt;module-name&gt;</code></li></ul><p>æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ä¸€ä¸ªç”±<code>@Module()</code>è£…é¥°å™¨æ³¨é‡Šçš„ç±»ï¼Œåº”ç”¨ä¸­æ¨¡å—é—´çš„å…³ç³»å°†ç”±<code>@Module()</code>è£…é¥°å™¨ä¸­æºå¸¦çš„æ‰€æœ‰å…ƒæ•°æ®æè¿°ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Module } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  providers: [],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  imports: [],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  controllers: [],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  exports: [],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><h3 id="module-å…ƒæ•°æ®" tabindex="-1">@Module() å…ƒæ•°æ® <a class="header-anchor" href="#module-å…ƒæ•°æ®" aria-label="Permalink to &quot;@Module() å…ƒæ•°æ®&quot;">â€‹</a></h3><p>é€šè¿‡ <strong>Orders</strong> æ¨¡å—äº†è§£<code>@Module()</code>å…ƒæ•°æ®å¦‚ä½•ç»„ç»‡æ¨¡å—ï¼š</p><p>/tab</p><table><thead><tr><th>providers</th><th>æ³¨å†Œè®¢å•æä¾›è€…æ¨¡å—ï¼Œå¦‚ï¼šè´Ÿè´£è®¢å• CRUD çš„æœåŠ¡ï¼›</th></tr></thead><tbody><tr><td>controllers</td><td>æ³¨å†Œè®¢å•æ§åˆ¶å™¨æ¨¡å—ï¼Œå¦‚ï¼šè´Ÿè´£è®¢å• CRUD çš„è·¯ç”±å¤„ç†ï¼›</td></tr><tr><td>imports</td><td>æ³¨å†Œä¸è®¢å•ç›¸å…³è”çš„æ¨¡å—ï¼Œå¦‚ï¼šä¸è®¢å•å…³è”çš„ç”¨æˆ·æŸ¥è¯¢æœåŠ¡ï¼›</td></tr><tr><td>exports</td><td>å¯¼å‡ºè®¢å•æä¾›è€…æ¨¡å—ï¼Œå¦‚ï¼šç”¨æˆ·æŸ¥è¯¢éœ€è¦è®¢å•æä¾›è€…ç»Ÿè®¡è®¢å•æ•°é‡ï¼›</td></tr></tbody></table><p>ğŸ’¡ PSï¼š<strong>Orders</strong> æ¨¡å—é€šè¿‡<code>exports</code>å°†è®¢å•æä¾›è€…æ¨¡å—å¯¼å‡ºçš„è¡Œä¸ºç§°ä¸º<strong>æ¨¡å—å…±äº«</strong>ï¼›</p><h3 id="æ¨¡å—å†å¯¼å‡º" tabindex="-1">æ¨¡å—å†å¯¼å‡º <a class="header-anchor" href="#æ¨¡å—å†å¯¼å‡º" aria-label="Permalink to &quot;æ¨¡å—å†å¯¼å‡º&quot;">â€‹</a></h3><p>ä¸€ä¸ªæ¨¡å—ä»…è´Ÿè´£å°†ä¸€ç³»åˆ—ç›¸å…³è”çš„æ¨¡å—é€šè¿‡<code>imports</code>å¯¼å…¥ï¼Œç´§æ¥ç€å°±é€šè¿‡<code>exports</code>å…¨éƒ¨å¯¼å‡ºçš„è¡Œä¸ºå°±æ˜¯æ¨¡å—åœ¨å¯¼å‡ºï¼Œåˆ©ç”¨<strong>æ¨¡å—å†å¯¼å‡º</strong>çš„èƒ½åŠ›ï¼Œå¯ä»¥å‡å°‘å¤§é‡å…³è”æ¨¡å—é‡å¤å¯¼å…¥é€ æˆçš„è´Ÿæ‹…ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  imports: [DatabaseModule, RedisModule, MongoModule],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  exports: [DatabaseModule, RedisModule, MongoModule],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ConnectionModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><p>ğŸ’¡ PSï¼šåœ¨éœ€è¦åŒæ—¶ä½¿ç”¨æ•°æ®åº“è¿æ¥ã€Redis è¿æ¥ã€Mongo è¿æ¥çš„æƒ…å†µä¸‹ä»…éœ€è¦å¯¼ <strong>ConnectionModule</strong> æ¨¡å—å³å¯ã€‚</p><h3 id="å…¨å±€æ¨¡å—" tabindex="-1">å…¨å±€æ¨¡å— <a class="header-anchor" href="#å…¨å±€æ¨¡å—" aria-label="Permalink to &quot;å…¨å±€æ¨¡å—&quot;">â€‹</a></h3><p>å¦‚æœéœ€è¦ <strong>ConnectionModule</strong> æ¨¡å—åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½å¼€ç®±å³ç”¨ï¼Œé‚£å¯ä»¥ä¸ºå…¶å¢åŠ  <code>@Global()</code> è£…é¥°å™¨ï¼›</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Global</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  imports: [DatabaseModule, RedisModule, MongoModule],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  exports: [DatabaseModule, RedisModule, MongoModule],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ConnectionModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><h2 id="æ§åˆ¶å™¨çš„ä½¿ç”¨" tabindex="-1">æ§åˆ¶å™¨çš„ä½¿ç”¨ <a class="header-anchor" href="#æ§åˆ¶å™¨çš„ä½¿ç”¨" aria-label="Permalink to &quot;æ§åˆ¶å™¨çš„ä½¿ç”¨&quot;">â€‹</a></h2><p>æ§åˆ¶å™¨ç”¨æ¥æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„ç‰¹å®šè¯·æ±‚ï¼Œä¸åŒçš„å®¢æˆ·ç«¯è¯·æ±‚å°†ç”± <strong>Nestjs</strong> è·¯ç”±æœºåˆ¶åˆ†é…åˆ°å¯¹åº”çš„æ§åˆ¶å™¨è¿›è¡Œå¤„ç†ã€‚</p><h3 id="åˆ›å»ºæ§åˆ¶å™¨" tabindex="-1">åˆ›å»ºæ§åˆ¶å™¨ <a class="header-anchor" href="#åˆ›å»ºæ§åˆ¶å™¨" aria-label="Permalink to &quot;åˆ›å»ºæ§åˆ¶å™¨&quot;">â€‹</a></h3><ul><li>å®Œæ•´å‘½ä»¤ï¼š<code>nest generate controller &lt;controller-name&gt;</code></li><li>ç®€å†™å‘½ä»¤ï¼š<code>nest g co &lt;controller-name&gt;</code></li></ul><p>æ§åˆ¶å™¨æ˜¯ä½¿ç”¨<code>@Controller(â€™pathâ€™)</code>è£…é¥°å™¨æ³¨é‡Šçš„ç±»ï¼Œå…¶ä¸­<code>path</code>æ˜¯ä¸€ä¸ªå¯é€‰çš„è·¯ç”±è·¯å¾„å‰ç¼€ï¼Œé€šè¿‡<code>path</code>å¯ä»¥å°†ç›¸å…³çš„è·¯ç”±è¿›è¡Œåˆ†ç»„ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Controller, Get } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  index</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;This is the order controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡ å°ç»“ï¼š</p><ol><li>å½“å®¢æˆ·ç«¯é€šè¿‡ <strong>GET</strong> æ–¹æ³•å¯¹ <code>orders</code> è·¯ç”±å‘é€è¯·æ±‚æ—¶å°†ç”± <code>index()</code> å¤„ç†å‡½æ•°å“åº”ã€‚</li><li>é™¤<code>@Get()</code>è£…é¥°å™¨å¤–ï¼Œ<strong>Nestjs</strong> è¿˜ä¸º <strong>HTTP</strong> æ ‡å‡†æ–¹æ³•æä¾›çš„è£…é¥°æœ‰<code>@Post()</code>ã€<code>@Put()</code>ã€<code>@Delete()</code>ã€<code>@Patch()</code>ã€<code>@Options()</code>å’Œ<code>@Head()</code>ï¼Œä»¥åŠ<code>@All()</code>ç”¨æ¥å¤„ç†æ‰€æœ‰çš„æƒ…å†µã€‚</li><li><code>@Controller(â€™pathâ€™)</code>ä¸­çš„ <code>path</code> ä»è®¾è®¡ä¸Šè™½ä¸ºå¯é€‰å‚æ•°ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­æœªé¿å…æ··ä¹±ä¼šåœ¨åˆ›å»ºæ§åˆ¶å™¨åä¼˜å…ˆåˆ†é… <code>path</code>ã€‚</li></ol><h3 id="è¯»å–è¯·æ±‚å¯¹è±¡" tabindex="-1">è¯»å–è¯·æ±‚å¯¹è±¡ <a class="header-anchor" href="#è¯»å–è¯·æ±‚å¯¹è±¡" aria-label="Permalink to &quot;è¯»å–è¯·æ±‚å¯¹è±¡&quot;">â€‹</a></h3><p>è¯·æ±‚å¯¹è±¡è¡¨ç¤ºä¸€ä¸ª <strong>HTTP</strong> è¯·æ±‚æ‰€æºå¸¦çš„æ•°æ®ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚æ•°æ®ä¸­çš„æŸ¥è¯¢å‚æ•°ã€è·¯ç”±å‚æ•°ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰æ•°æ®ã€‚é€šè¿‡åœ¨ <strong>OrdersController</strong> æ§åˆ¶å™¨ä¸­ç¼–å†™æ›´å¤šçš„å¤„ç†æ–¹æ³•æ¥æ¼”ç¤ºæ¥æ”¶ä¸åŒçš„ <strong>HTTP</strong> æ–¹æ³•å’Œä¸åŒä½ç½®çš„å‚æ•°ï¼š</p><ol><li>é€šè¿‡ <strong>GET</strong> æ–¹æ³•è·å–è®¢å•åˆ—è¡¨æ•°æ®ï¼Œå¹¶é€šè¿‡<strong>æŸ¥è¯¢å‚æ•°</strong>ä¼ é€’è®¢å•åˆ†é¡µæ•°æ®ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;list&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Query</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;page&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) page: number, @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Query</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;limit&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) limit: number) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`è·å–ç¬¬\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">page</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}é¡µï¼Œæ¯é¡µ\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">limit</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}æ¡è®¢å•\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">curl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">request GET \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">url </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;http://localhost:3000/orders/list?page=1&amp;limit=20&#39;</span></span></code></pre></div><ol><li>é€šè¿‡ <strong>GET</strong> æ–¹æ³•æŸ¥è¯¢æŒ‡å®š ID çš„è®¢å•è¯¦æƒ…ï¼Œå¹¶é€šè¿‡<strong>è·¯ç”±å‚æ•°</strong>ä¼ é€’è®¢å• IDï¼›</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;detail/:id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findById</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() param: { id: number }) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`è·å– ID ä¸º \${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">param</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} çš„è®¢å•è¯¦æƒ…\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">curl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">request GET \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">url http:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">//</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">orders</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span></span></code></pre></div><ol><li>é€šè¿‡ <strong>PATCH</strong> æ–¹æ³•æ›´æ–°æŒ‡å®š ID è®¢å•çš„æœ€æ–°çŠ¶æ€ï¼Œå¹¶é€šè¿‡è·¯ç”±å‚æ•°ä¼ é€’è®¢å• ID åŠæœ€æ–°çŠ¶æ€ï¼›</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Patch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;:id/:status&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">updateByIdAndStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) id: number,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;status&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) status: string,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`å°† ID ä¸º \${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} è®¢å•çŠ¶æ€æ›´æ–°ä¸º \${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">curl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">request PATCH \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">url </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;http://localhost:3000/orders/1/å·²é€€æ¬¾&#39;</span></span></code></pre></div><ol><li>é€šè¿‡ <strong>POST</strong> æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„è®¢å•ï¼Œå¹¶é€šè¿‡è¯·æ±‚ä½“ <strong>Body</strong> æ¥æ”¶è®¢å•æ•°æ®ï¼›</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ICreateOrder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">  article</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">  price</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">  count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">  source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() order: ICreateOrder) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`åˆ›å»ºè®¢å•ï¼Œè®¢å•ä¿¡æ¯ä¸º \${</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">JSON</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">stringify</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">order</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">curl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">request POST \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">url http:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">//</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">localhost:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">orders \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">header </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;content-type: application/json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">data </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">	&quot;article&quot;: &quot;HUAWEI-Meta60&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">	&quot;price&quot;: 5999,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">	&quot;count&quot;: 1,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">	&quot;source&quot;: &quot;Made in China&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&#39;</span></span></code></pre></div><p>ğŸ’¡ å°ç»“ï¼š</p><ol><li>æ§åˆ¶å™¨ä¸­ä¸åŒçš„å¤„ç†å‡½æ•°å¯ä»¥é€šè¿‡ <strong>HTTP</strong> æ–¹æ³•æ¥åŒºåˆ†ï¼›</li><li>å½“å¤šä¸ªå¤„ç†å‡½æ•°éœ€è¦ä½¿ç”¨ç›¸åŒçš„ <strong>HTTP</strong> æ–¹æ³•æ—¶éœ€è¦æ·»åŠ å¤„ç†å‡½æ•°çº§åˆ«çš„è·¯ç”±ä»¥ç¤ºåŒºåˆ†ï¼›</li><li><code>@Param()</code>æœªæŒ‡å®šå‚æ•°æ—¶è¡¨ç¤ºæ‰€æœ‰è·¯ç”±å‚æ•°çš„é›†åˆï¼ŒæŒ‡å®šå‚æ•°æ—¶è¡¨ç¤ºå¯¹åº”æŒ‡å®šçš„å‚æ•°ï¼Œ<code>@Query()</code>ä¸<code>@Param()</code>å…·æœ‰ç›¸åŒçš„ç‰¹ç‚¹ã€‚</li></ol><h3 id="æ›´å¤šè£…é¥°å™¨" tabindex="-1">æ›´å¤šè£…é¥°å™¨ <a class="header-anchor" href="#æ›´å¤šè£…é¥°å™¨" aria-label="Permalink to &quot;æ›´å¤šè£…é¥°å™¨&quot;">â€‹</a></h3><ol><li>@Header(key, value)ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Header</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Cache-Control&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;none&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() createOrderDto: CreateOrderDto) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(createOrderDto);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol><li>@Redirect(res, statusCode)</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;:id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;https://nestjs.com/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">301</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) id: string) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡ å°ç»“ï¼š</p><ol><li>301ï¼šèµ„æºè¢«æ°¸ä¹…é‡å®šå‘åˆ°æ–°çš„èµ„æºï¼Œå®¢æˆ·ç«¯éœ€è¦è€ƒè™‘åŒæ­¥æ›´æ–°ï¼›</li><li>302ï¼šèµ„æºè¢«ä¸´æ—¶é‡å®šå‘åˆ°æ–°çš„èµ„æºï¼Œå¦‚ï¼šæœåŠ¡ç«¯å‡çº§æ—¶ä¼šå¯ç”¨ä¸´æ—¶èµ„æºï¼›</li></ol><p>ä¸‹é¢åˆ—å‡ºçš„å†…ç½®è£…é¥°å™¨å¯ç®€åŒ–è¯·æ±‚æ•°æ®ä¿¡æ¯çš„è¯»å–ï¼š</p><table><thead><tr><th>@Request(), @Req()</th><th>req</th></tr></thead><tbody><tr><td>@Response(), @Res()*</td><td>res</td></tr><tr><td>@Next()</td><td>next</td></tr><tr><td>@Session()</td><td>req.session</td></tr><tr><td>@Param(key?: string)</td><td>req.params / req.params[key]</td></tr><tr><td>@Body(key?: string)</td><td>req.body / req.body[key]</td></tr><tr><td>@Query(key?: string)</td><td>req.query / req.query[key]</td></tr><tr><td>@Headers(name?: string)</td><td>req.headers / req.headers[name]</td></tr><tr><td>@Ip()</td><td>req.ip</td></tr><tr><td>@HostParam()</td><td>req.hosts</td></tr></tbody></table><h2 id="æä¾›è€…çš„ä½¿ç”¨" tabindex="-1">æä¾›è€…çš„ä½¿ç”¨ <a class="header-anchor" href="#æä¾›è€…çš„ä½¿ç”¨" aria-label="Permalink to &quot;æä¾›è€…çš„ä½¿ç”¨&quot;">â€‹</a></h2><p>åœ¨ Nestjs ä¸­å°†æä¾›æœåŠ¡çš„ç±»åŠä¸€äº›å·¥å‚ç±»ã€åŠ©æ‰‹ç±»ç­‰ç§°ä½œæä¾›è€…ï¼Œå®ƒä»¬åŒæ—¶å‡å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼ä½œä¸ºä¾èµ–æ¨¡å—ï¼›</p><h3 id="åˆ›å»ºæœåŠ¡" tabindex="-1">åˆ›å»ºæœåŠ¡ <a class="header-anchor" href="#åˆ›å»ºæœåŠ¡" aria-label="Permalink to &quot;åˆ›å»ºæœåŠ¡&quot;">â€‹</a></h3><ul><li>å®Œæ•´å‘½ä»¤ï¼š<code>nest generate service orders</code>ï¼›</li><li>ç®€å†™å‘½ä»¤ï¼š<code>nest g s orders</code>ï¼›</li></ul><p>æœåŠ¡æ˜¯å…¸å‹çš„æä¾›è€…ï¼ŒHTTP è¯·æ±‚åœ¨ç»è¿‡æ§åˆ¶å™¨å¤„ç†ååº”è¯¥å°†å¤æ‚çš„ä»»åŠ¡äº¤ç”±æœåŠ¡å±‚è¿›è¡Œå¤„ç†ï¼Œå¦‚ï¼šå°†å¤æ‚çš„è®¢å•ç”Ÿæˆã€æŸ¥è¯¢ã€æ›´æ–°åŠåˆ é™¤ç­‰æ“ä½œè¿›è¡Œå°è£…ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Injectable } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { CreateOrderDto } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;./dto/create-order.dto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { UpdateOrderDto } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;./dto/update-order.dto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersService</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">createOrderDto</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CreateOrderDto</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;This action adds a new order&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`This action returns all orders\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`This action returns a #\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} order\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  update</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">updateOrderDto</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> UpdateOrderDto</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`This action updates a #\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} order\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  remove</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`This action removes a #\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} order\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡ PSï¼š<strong>Nestjs</strong> åº”ç”¨å¯åŠ¨æ—¶å¿…é¡»è§£æå…¨éƒ¨ä¾èµ–ï¼Œå› æ­¤æ¯ä¸ªæä¾›è€…éƒ½å°†å®ä¾‹åŒ–å®Œæˆï¼ŒåŒæ—¶åœ¨åº”ç”¨åœæ­¢åæ¯ä¸ªæä¾›è€…å°†å…¨éƒ¨è¢«é”€æ¯ï¼Œæ‰€ä»¥é»˜è®¤çš„æä¾›è€…ç”Ÿå‘½å‘¨æœŸåŒåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h3 id="æ³¨å…¥å¹¶ä½¿ç”¨" tabindex="-1">æ³¨å…¥å¹¶ä½¿ç”¨ <a class="header-anchor" href="#æ³¨å…¥å¹¶ä½¿ç”¨" aria-label="Permalink to &quot;æ³¨å…¥å¹¶ä½¿ç”¨&quot;">â€‹</a></h3><p>å°† <strong>OrdersService</strong> é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥åˆ° <strong>OrdersController</strong> æ§åˆ¶å™¨ï¼Œè¿™æ ·å°±å¾—åˆ°äº†åˆå§‹åŒ–åçš„ <strong>ordersService</strong> æˆå‘˜ï¼Œæ¥ç€å°±å¯ä»¥åœ¨ä¸åŒçš„å¤„ç†å‡½æ•°è°ƒç”¨æœåŠ¡ä¸­æä¾›çš„èƒ½åŠ›ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Controller, Get, Post, Body, Param } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { OrdersService } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;./orders.service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { CreateOrderDto } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;./dto/create-order.dto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;"> ordersService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersService</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">createOrderDto</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CreateOrderDto</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(createOrderDto);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;:id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡ PSï¼š</p><p>é™¤æ„é€ å‡½æ•°æ³¨å…¥çš„è¿™ç§æ–¹å¼å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å±æ€§æ³¨å…¥ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Inject</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">private readonly </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ordersService</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: OrdersService;</span></span></code></pre></div><h2 id="ä¸­é—´ä»¶çš„ä½¿ç”¨" tabindex="-1">ä¸­é—´ä»¶çš„ä½¿ç”¨ <a class="header-anchor" href="#ä¸­é—´ä»¶çš„ä½¿ç”¨" aria-label="Permalink to &quot;ä¸­é—´ä»¶çš„ä½¿ç”¨&quot;">â€‹</a></h2><p>ä¸­é—´ä»¶æ˜¯è·¯ç”±å¤„ç†ç¨‹åºä¹‹å‰è¿è¡Œçš„å‡½æ•°ï¼Œåœ¨ä¸­é—´ä»¶ä¸­å¯ä»¥è®¿é—® request å’Œ response å¯¹è±¡ï¼Œä»¥åŠå°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„<code>next()</code>å‡½æ•°ã€‚</p><h3 id="åˆ›å»ºä¸­é—´ä»¶" tabindex="-1">åˆ›å»ºä¸­é—´ä»¶ <a class="header-anchor" href="#åˆ›å»ºä¸­é—´ä»¶" aria-label="Permalink to &quot;åˆ›å»ºä¸­é—´ä»¶&quot;">â€‹</a></h3><ul><li>å®Œæ•´å‘½ä»¤ï¼š<code>nest generate middleware &lt;middleware-name&gt;</code></li><li>ç®€å†™å‘½ä»¤ï¼š<code>nest g mi &lt;middleware-name&gt;</code></li></ul><p>ä¸­é—´ä»¶æ˜¯ä¸€ä¸ªä½¿ç”¨<code>@Injectable()</code>è£…é¥°å™¨æ³¨é‡Šä¸”å®ç°<strong>NestMiddleware</strong>æ¥å£çš„ç±»ï¼Œ</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Injectable, NestMiddleware } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Request, Response } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;express&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> LoggerMiddleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  use</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">req</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">hrtime</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> diff</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">hrtime</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(start);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (diff[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> diff[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e-6</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">toFixed</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">method</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} \${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} - \${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">time</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}ms\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    });</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    next</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡ PSï¼šå¯¹äºæ²¡æœ‰å±æ€§ã€æ²¡æœ‰é¢å¤–çš„å‡½æ•°ä¹Ÿæ²¡æœ‰é¢å¤–çš„ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæ™®é€šçš„å‡½æ•°æ¥è¡¨ç¤ºä¸­é—´ä»¶ï¼Œè¿™ç±»ä¸­é—´ä»¶æˆä¸º<strong>åŠŸèƒ½ç±»ä¸­é—´ä»¶</strong>ã€‚</p><h3 id="æ³¨å†Œä¸­é—´ä»¶" tabindex="-1">æ³¨å†Œä¸­é—´ä»¶ <a class="header-anchor" href="#æ³¨å†Œä¸­é—´ä»¶" aria-label="Permalink to &quot;æ³¨å†Œä¸­é—´ä»¶&quot;">â€‹</a></h3><p>ä¸­é—´ä»¶çš„æ³¨å†Œäºæ§åˆ¶å™¨å’Œæä¾›è€…çš„æ³¨å†Œæ–¹å¼ä¸åŒï¼Œéœ€è¦åœ¨æ¶ˆè´¹ä¸­é—´ä»¶çš„æ¨¡å—é€šè¿‡ç»§æ‰¿ <strong>NestModule</strong> å¹¶å®ç° <code>configure</code> æ¥å£ï¼Œå¦‚ä¸‹é¢æˆ‘ä»¬åœ¨è®¢å•æ¨¡å—ä¸­æ³¨å†Œäº†è¿™ä¸ª <strong>Logger</strong> ä¸­é—´ä»¶ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { MiddlewareConsumer, Module, NestModule } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { OrdersService } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;./orders.service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { OrdersController } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;./orders.controller&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { LoggerMiddleware } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;src/logger/logger.middleware&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  controllers: [OrdersController],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  providers: [OrdersService],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  configure</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> MiddlewareConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    consumer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(LoggerMiddleware).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">forRoutes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡ PSï¼š<code>forRoutes()</code>æ”¯æŒå¤šç§å½¢å¼çš„å‚æ•°æ¥è¡¨ç¤ºç”Ÿæ•ˆçš„èŒƒå›´ï¼Œå¦‚ï¼šå•å­—ç¬¦ä¸²ã€å¤šä¸ªå­—ç¬¦ä¸²ã€RouteInfo å¯¹è±¡ã€å•ä¸ªæ§åˆ¶å™¨ç±»æˆ–å¤šä¸ªæ§åˆ¶å™¨ç±»ã€‚</p><h3 id="èŒƒå›´æ§åˆ¶" tabindex="-1">èŒƒå›´æ§åˆ¶ <a class="header-anchor" href="#èŒƒå›´æ§åˆ¶" aria-label="Permalink to &quot;èŒƒå›´æ§åˆ¶&quot;">â€‹</a></h3><p><strong>MiddlewareConsumer</strong> æä¾›äº†<code>exclude</code>å‡½æ•°æ¥æŒ‰è§„åˆ™æ’é™¤ä¸€äº›ä¸åº”ç”¨ä¸­é—´ä»¶çš„è·¯ç”±ï¼Œå…·ä½“çš„è§„åˆ™å¯è§ <a href="https://github.com/pillarjs/path-to-regexp#parameters" target="_blank" rel="noreferrer">path-to-regexp</a>ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// åŸºäºå…·ä½“è·¯ç”±é…ç½®åŠæ¨¡å¼åŒ¹é…çš„æ’é™¤æ–¹æ¡ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">consumer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(LoggerMiddleware)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    { path: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, method: RequestMethod.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    { path: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, method: RequestMethod.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">POST</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    &quot;orders/(.*)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">forRoutes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span></code></pre></div><p><strong>MiddlewareConsumer</strong> æä¾›çš„ <code>forRoutes</code>æ”¯æŒä¸‹é¢è¿™ç§æ¨¡å¼åŒ¹é…çš„æ–¹å¼ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">forRoutes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({ path: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;ab*cd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, method: RequestMethod.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">ALL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> });</span></span></code></pre></div><h3 id="ä¸­é—´ä»¶ä¸²è”" tabindex="-1">ä¸­é—´ä»¶ä¸²è” <a class="header-anchor" href="#ä¸­é—´ä»¶ä¸²è”" aria-label="Permalink to &quot;ä¸­é—´ä»¶ä¸²è”&quot;">â€‹</a></h3><p>å½“ä¸€ä¸ªä¸­é—´ä»¶å¤„ç†å®Œæˆåï¼Œå¦‚æœè¯·æ±‚è¿˜æ²¡æœ‰ç»“æŸå°†æœ‰<code>next()</code>å‡½æ•°å°†æ§åˆ¶æƒå‘ä¸‹ä¼ é€’ã€‚å¦‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼šä¸ºäº†å…è®¸å®¢æˆ·ç«¯å‘èµ·è·¨åŸŸè®¿é—®ï¼Œåœ¨ <strong>Cors</strong> ä¸­é—´ä»¶ä¸­ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚æ·»åŠ ç‰¹æ®Šçš„è¯·æ±‚å¤´åå†äº¤ç”± <strong>Logger</strong> ä¸­é—´ä»¶ç»§ç»­æ‰§è¡Œã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Injectable, NestMiddleware } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Request, Response } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;express&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CorsMiddleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  use</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">req</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Request</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Response</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;Access-Control-Allow-Origin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// å…è®¸æ‰€æœ‰æ¥æº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;Access-Control-Allow-Headers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;Content-Type,Authorization&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// å…è®¸æŒ‡å®šçš„è¯·æ±‚å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      &quot;Access-Control-Allow-Methods&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      &quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ); </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// å…è®¸æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    next</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  configure</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> MiddlewareConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    consumer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(CorsMiddleware, LoggerMiddleware).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">forRoutes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="å…¨å±€ä¸­é—´ä»¶" tabindex="-1">å…¨å±€ä¸­é—´ä»¶ <a class="header-anchor" href="#å…¨å±€ä¸­é—´ä»¶" aria-label="Permalink to &quot;å…¨å±€ä¸­é—´ä»¶&quot;">â€‹</a></h3><p>å…¨å±€æ³¨å†Œ <strong>ç±»ä¸­é—´ä»¶</strong>ï¼Œå¯ä»¥åœ¨æ ¹æ¨¡å— <strong>AppModule</strong> ä¸­æ³¨å†Œï¼Œä½¿ç”¨é€šé…ç¬¦çš„å½¢å¼è¡¨ç¤º <code>forRoutes(&#39;*&#39;)</code>ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> AppModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  configure</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">consumer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> MiddlewareConsumer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    consumer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(CorsMiddleware, LoggerMiddleware).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">forRoutes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>å¦‚æœéœ€è¦å…¨å±€æ³¨å†Œ <strong>åŠŸèƒ½ç±»ä¸­é—´ä»¶</strong> ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨åˆ›å»º <strong>app</strong> å®ä¾‹åï¼Œé€šè¿‡ <code>app.use(&#39;&#39;)</code> å‡½æ•°æ³¨å†Œï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> NestFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(AppModule);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(logger);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span></code></pre></div><h2 id="å®ˆå«çš„ä½¿ç”¨" tabindex="-1">å®ˆå«çš„ä½¿ç”¨ <a class="header-anchor" href="#å®ˆå«çš„ä½¿ç”¨" aria-label="Permalink to &quot;å®ˆå«çš„ä½¿ç”¨&quot;">â€‹</a></h2><p>å®ˆå«ä¾æ®æœåŠ¡è¿è¡ŒæœŸé—´çš„æƒé™ã€è§’è‰²åŠè®¿é—®æ§åˆ¶åˆ—è¡¨ç­‰æ¡ä»¶æ¥ç¡®å®šå®¢æˆ·ç«¯çš„è®¿é—®æ˜¯å¦äº¤ç”±è·¯ç”±å¤„ç†ç¨‹åºå¤„ç†ã€‚ç›¸æ¯”äºä¼ ç»Ÿçš„ä¸­é—´ä»¶å……å½“å®ˆå«çš„è§’è‰²è€Œè¨€ ï¼ŒNestJS æä¾›çš„å®ˆå«æ”¯æŒè®¿é—®<code>ExecutionContext</code> ****å®ä¾‹ï¼Œå› æ­¤å¯ä»¥æ˜ç¡®çŸ¥é“æ¥ç€è¦æ‰§è¡Œä»€ä¹ˆã€‚</p><h3 id="åˆ›å»ºå®ˆå«" tabindex="-1">åˆ›å»ºå®ˆå« <a class="header-anchor" href="#åˆ›å»ºå®ˆå«" aria-label="Permalink to &quot;åˆ›å»ºå®ˆå«&quot;">â€‹</a></h3><ul><li>å®Œæ•´å‘½ä»¤ï¼š<code>nest generate guard &lt;guard-name&gt;</code></li><li>ç®€å†™å‘½ä»¤ï¼š<code>nest g gu &lt;guard-name&gt;</code></li></ul><p>å®ˆå«ä¹Ÿæ˜¯ä¸€ä¸ªä½¿ç”¨<code>@Injectable()</code>è£…é¥°å™¨æ³¨é‡Šçš„ç±»ï¼Œå®ƒéœ€è¦å®ç° <code>CanActivate</code> æ¥å£ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { CanActivate, ExecutionContext, Injectable } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Observable } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;rxjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> RolesGuard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> CanActivate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  canActivate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">    context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ExecutionContext</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  )</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="åŸºäºè§’è‰²å®ˆå«" tabindex="-1">åŸºäºè§’è‰²å®ˆå« <a class="header-anchor" href="#åŸºäºè§’è‰²å®ˆå«" aria-label="Permalink to &quot;åŸºäºè§’è‰²å®ˆå«&quot;">â€‹</a></h3><p>é¦–å…ˆè¦ä½¿ç”¨<code>Reflector</code>åˆ›å»ºä¸€ä¸ªç”¨æ¥åˆ†é…è§’è‰²çš„è£…é¥°å™¨ï¼Œç„¶ååœ¨å¯¹åº”çš„è·¯ç”±å¤„ç†å‡½æ•°ä¸Šæ·»åŠ è¿™ä¸ªè£…é¥°å™¨å¹¶åˆ†é…æƒé™ï¼›</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Reflector } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> Roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Reflector.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">createDecorator</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]&gt;();</span></span></code></pre></div><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Roles</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;admin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() createOrderDto: CreateOrderDto) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(createOrderDto);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>æ¥ç€åœ¨<code>RolesGuard</code> ä¸­é€šè¿‡ <strong>æ‰§è¡Œä¸Šä¸‹æ–‡ç±»</strong> è·å–è¢«è°ƒç”¨å¤„ç†å‡½æ•°çš„å¼•ç”¨ï¼Œå¹¶æ³¨å…¥<code>Reflector</code>æ¥æå–å¤„ç†å‡½æ•°è¢«åˆ†é…çš„è§’è‰²ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { CanActivate, ExecutionContext, Injectable } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Reflector } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Observable } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;rxjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Roles } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;./roles.decorator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> RolesGuard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> CanActivate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;"> reflector</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Reflector</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  canActivate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">    context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ExecutionContext</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  )</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> handler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> roles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.reflector.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[]&gt;(Roles, handler);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(roles); </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// output [&#39;admin&#39;]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ç°åœ¨å‡è®¾ä¸å®¢æˆ·ç«¯åå•†é€šè¿‡ <strong>Header</strong> ä¸­æ·»åŠ  <code>role</code> å±æ€§æ¥ä¼ é€’è§’è‰²ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨<code>RolesGuard</code>ä¸­å¯ä»¥é€šè¿‡æ‰§è¡Œä¸Šä¸‹æ–‡è·å– <strong>Request</strong> å¯¹è±¡ä¸­çš„è¯·æ±‚å¤´æ•°æ®ï¼Œæœ€åå¯¹æ¯”è§’è‰²åˆ—è¡¨ï¼Œå¹¶è¿”å›æ˜¯å¦åŒ…å«è§’è‰²çš„ç»“æœï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span>import { CanActivate, ExecutionContext, Injectable } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span>import { Reflector } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span>import { Observable } from &#39;rxjs&#39;;</span></span>
<span class="line"><span>import { Roles } from &#39;./roles.decorator&#39;;</span></span>
<span class="line"><span>import { Request } from &#39;express&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@Injectable()</span></span>
<span class="line"><span>export class RolesGuard implements CanActivate {</span></span>
<span class="line"><span>  constructor(private readonly reflector: Reflector) {}</span></span>
<span class="line"><span>  canActivate(</span></span>
<span class="line"><span>    context: ExecutionContext,</span></span>
<span class="line"><span>  ): boolean | Promise&lt;boolean&gt; | Observable&lt;boolean&gt; {</span></span>
<span class="line"><span>    const handler = context.getHandler();</span></span>
<span class="line"><span>    const roles = this.reflector.get&lt;string[]&gt;(Roles, handler);</span></span>
<span class="line"><span>    const request: Request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span>    const role = request.headers[&#39;role&#39;] || &#39;&#39;;</span></span>
<span class="line"><span>    return roles.includes(role as string);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ç»‘å®šå®ˆå«" tabindex="-1">ç»‘å®šå®ˆå« <a class="header-anchor" href="#ç»‘å®šå®ˆå«" aria-label="Permalink to &quot;ç»‘å®šå®ˆå«&quot;">â€‹</a></h3><p>æ§åˆ¶å™¨èŒƒå›´ç»‘å®šï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseGuards</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(RolesGuard)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;orders&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseGuards</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> RolesGuard</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><p>å…¨å±€èŒƒå›´ç»‘å®šï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> NestFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(AppModule);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">useGlobalGuards</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> RolesGuard</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  providers: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      provide: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">APP_GUARD</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      useClass: RolesGuard,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> AppModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><h2 id="æ‹¦æˆªå™¨çš„ä½¿ç”¨" tabindex="-1">æ‹¦æˆªå™¨çš„ä½¿ç”¨ <a class="header-anchor" href="#æ‹¦æˆªå™¨çš„ä½¿ç”¨" aria-label="Permalink to &quot;æ‹¦æˆªå™¨çš„ä½¿ç”¨&quot;">â€‹</a></h2><p>æ‹¦æˆªå™¨æ˜¯åº”ç”¨ AOP åˆ‡é¢ç¼–ç¨‹æ¨¡å¼æ¥å¯¹è·¯ç”±å¤„ç†å‡½æ•°è¿›è¡ŒåŠŸèƒ½æ‰©å±•çš„æŠ€æœ¯ï¼Œé€šè¿‡æ‹¦æˆªå™¨å¯ä»¥æ‰©å±•ä¸‹é¢è¿™äº›èƒ½åŠ›ï¼š</p><ul><li>åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰/ä¹‹åç»‘å®šé¢å¤–çš„é€»è¾‘</li><li>è½¬æ¢å‡½æ•°è¿”å›çš„ç»“æœ</li><li>è½¬æ¢å‡½æ•°æŠ›å‡ºçš„å¼‚å¸¸</li><li>æ‰©å±•åŸºæœ¬åŠŸèƒ½è¡Œä¸º</li><li>æ ¹æ®ç‰¹å®šæ¡ä»¶å®Œå…¨è¦†ç›–å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œç¼“å­˜ï¼‰</li></ul><h3 id="åˆ›å»ºæ‹¦æˆªå™¨" tabindex="-1">åˆ›å»ºæ‹¦æˆªå™¨ <a class="header-anchor" href="#åˆ›å»ºæ‹¦æˆªå™¨" aria-label="Permalink to &quot;åˆ›å»ºæ‹¦æˆªå™¨&quot;">â€‹</a></h3><ul><li>å®Œæ•´å‘½ä»¤ï¼š<code>nest generate interceptor &lt;interceptor-name&gt;</code></li><li>ç®€å†™å‘½ä»¤ï¼š<code>nest g itc &lt;interceptor-name&gt;</code></li></ul><p>æ‹¦æˆªå™¨ä¹Ÿæ˜¯ä¸€ä¸ªä½¿ç”¨<code>@Injectable()</code>è£…é¥°å™¨æ³¨é‡Šçš„ç±»ï¼Œå®ƒéœ€è¦å®ç° <code>NestInterceptor</code> æ¥å£ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  CallHandler,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ExecutionContext,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  Injectable,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  NestInterceptor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Observable } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;rxjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> TimerInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  intercept</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CallHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> next.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">handle</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="è®°å½•æ‰§è¡Œæ—¶é—´" tabindex="-1">è®°å½•æ‰§è¡Œæ—¶é—´ <a class="header-anchor" href="#è®°å½•æ‰§è¡Œæ—¶é—´" aria-label="Permalink to &quot;è®°å½•æ‰§è¡Œæ—¶é—´&quot;">â€‹</a></h3><p>å½“å®¢æˆ·ç«¯çš„è¯·æ±‚è§¦å‘åˆ° <strong>TimerInterceptor</strong> æ‹¦æˆªå™¨æ—¶ï¼Œå°†è·å–åˆ°è¯·æ±‚å¯¹è±¡å®ä¾‹ï¼Œå¹¶è®°å½•ä¸‹äº†è¯·æ±‚è¿›å…¥çš„æ—¶é—´ç‚¹ï¼›</p><p>å½“ <code>next.handle()</code> å‡½æ•°è¿”å›ç»“æœåè¡¨ç¤ºå¯¹åº”çš„è·¯ç”±å¤„ç†å‡½æ•°å·²ç»æ‰§è¡Œå®Œæˆã€‚é€šè¿‡è¿”å›çš„ <strong>Observable</strong> å¯¹è±¡ï¼Œå¯ä»¥åœ¨å…¶ç®¡é“ä¸­ä½¿ç”¨ <code>tap</code> æ“ä½œç¬¦è®°å½•ç»“æŸæ—¶é—´å¹¶æ‰“å°æ‰§è¡Œæ—¶é•¿ä¿¡æ¯ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  CallHandler,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ExecutionContext,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  Injectable,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  NestInterceptor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { Observable, tap } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;rxjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> TimerInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  intercept</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CallHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">switchToHttp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">hrtime</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> next.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">handle</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">      tap</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> diff</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">hrtime</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(start);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (diff[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> diff[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1e-6</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">toFixed</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">method</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} \${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">req</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">} - \${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">time</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}ms\`</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="ç»‘å®šæ‹¦æˆªå™¨" tabindex="-1">ç»‘å®šæ‹¦æˆªå™¨ <a class="header-anchor" href="#ç»‘å®šæ‹¦æˆªå™¨" aria-label="Permalink to &quot;ç»‘å®šæ‹¦æˆªå™¨&quot;">â€‹</a></h3><p>æ§åˆ¶å™¨èŒƒå›´ç»‘å®šï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseInterceptors</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(TimerInterceptor)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseInterceptors</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> TimerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><p>å…¨å±€èŒƒå›´ç»‘å®šï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> NestFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(AppModule);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">useGlobalInterceptors</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> TimerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  providers: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      provide: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">APP_INTERCEPTOR</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      useClass: TimerInterceptor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> AppModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><h3 id="æ›´å¤šåº”ç”¨æ¡ˆä¾‹" tabindex="-1">æ›´å¤šåº”ç”¨æ¡ˆä¾‹ <a class="header-anchor" href="#æ›´å¤šåº”ç”¨æ¡ˆä¾‹" aria-label="Permalink to &quot;æ›´å¤šåº”ç”¨æ¡ˆä¾‹&quot;">â€‹</a></h3><ol><li>å“åº”æ˜ å°„ï¼šä½¿ç”¨<strong>Rxjs</strong>æä¾›çš„<code>map</code>æ“ä½œç¬¦å¯¹å¤„ç†å‡½æ•°è¿”å›çš„æ•°æ®åšäºŒæ¬¡åŠ å·¥ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> TransformInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  intercept</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CallHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> next.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">handle</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">      map</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          time: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          data,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol><li>å¼‚å¸¸æ˜ å°„ï¼šä½¿ç”¨<strong>Rxjs</strong>æä¾›çš„<code>catchError</code>æ“ä½œç¬¦æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ErrorsInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  intercept</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CallHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> next</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">handle</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">catchError</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> throwError</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> BadGatewayException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">())));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol><li>å¤„ç†å‡½æ•°è¶…æ—¶ï¼šä½¿ç”¨<strong>Rxjs</strong>æä¾›çš„<code>timeout</code>å’Œ<code>catchError</code>å…±åŒå®ç°å¤„ç†å‡½æ•°è¶…æ—¶ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> TimeoutInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> NestInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  intercept</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ExecutionContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">next</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CallHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> Observable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> next.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">handle</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">      timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">      catchError</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> TimeoutError</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">          return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> throwError</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> RequestTimeoutException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> throwError</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> err);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h2 id="å¼‚å¸¸è¿‡æ»¤å™¨çš„ä½¿ç”¨" tabindex="-1">å¼‚å¸¸è¿‡æ»¤å™¨çš„ä½¿ç”¨ <a class="header-anchor" href="#å¼‚å¸¸è¿‡æ»¤å™¨çš„ä½¿ç”¨" aria-label="Permalink to &quot;å¼‚å¸¸è¿‡æ»¤å™¨çš„ä½¿ç”¨&quot;">â€‹</a></h2><p><strong>NestJS</strong> å†…ç½®çš„ <strong>å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨</strong> è´Ÿè´£å¤„ç†åº”ç”¨ä¸­æ‰€æœ‰æœªå¤„ç†çš„ <strong>HttpException</strong> åŠå…¶å­ç±»çš„å¼‚å¸¸ï¼Œå…¶ä»–å¼‚å¸¸å°†ç”±å†…ç½®è¿‡æ»¤å™¨ç”Ÿæˆé»˜è®¤çš„ JSON å“åº”ï¼š</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;statusCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;Internal server error&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="æ ‡å‡†å¼‚å¸¸" tabindex="-1">æ ‡å‡†å¼‚å¸¸ <a class="header-anchor" href="#æ ‡å‡†å¼‚å¸¸" aria-label="Permalink to &quot;æ ‡å‡†å¼‚å¸¸&quot;">â€‹</a></h3><p>é€šè¿‡å®ä¾‹åŒ– <strong>NestJs</strong> å†…ç½®çš„ <code>HttpException</code> ç±»æ¥æŠ›å‡ºçš„å¼‚å¸¸ä¸ºæ ‡å‡†å¼‚å¸¸ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ç”± <code>message</code> å’Œ <code>statusCode</code> ç»„æˆçš„æ ‡å‡†ç¤ºä¾‹ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> HttpException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Forbidden&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">FORBIDDEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ä¸‹é¢çš„ä»£ç å®Œå…¨è‡ªå®šä¹‰äº†æŠ›å‡ºå¼‚å¸¸çš„ <strong>JSON</strong> å“åº”ä½“ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    // TODO</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> HttpException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        status: HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">FORBIDDEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        error: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;This is a custom message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">FORBIDDEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        cause: error,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">403</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;This is a custom message&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="è‡ªå®šä¹‰å¼‚å¸¸" tabindex="-1">è‡ªå®šä¹‰å¼‚å¸¸ <a class="header-anchor" href="#è‡ªå®šä¹‰å¼‚å¸¸" aria-label="Permalink to &quot;è‡ªå®šä¹‰å¼‚å¸¸&quot;">â€‹</a></h3><p>ç»§æ‰¿ <code>HttpException</code> ç±»å¯ä»¥å°è£…ç¬¦åˆè‡ªå·±é¡¹ç›®çš„è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæ­£å¦‚ä¸Šé¢å®Œå…¨è‡ªå®šä¹‰æŠ›å‡ºå¼‚å¸¸ <strong>JSON</strong> å“åº”ä½“çš„ä»£ç ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { HttpException, HttpStatus } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ForbiddenException</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> HttpException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        status: HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">FORBIDDEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        error: message,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">FORBIDDEN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        cause: error,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>åœ¨ <code>findAll</code> å‡½æ•°å°†æŠ›å‡ºæ ‡å‡†å¼‚å¸¸æ”¹ä¸ºè‡ªå®šä¹‰çš„ <code>ForbiddenException</code> å¼‚å¸¸ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    await</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> ForbiddenException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;This is a custom message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="å†…ç½®-http-å¼‚å¸¸" tabindex="-1">å†…ç½® HTTP å¼‚å¸¸ <a class="header-anchor" href="#å†…ç½®-http-å¼‚å¸¸" aria-label="Permalink to &quot;å†…ç½® HTTP å¼‚å¸¸&quot;">â€‹</a></h3><p>ä¸‹é¢è¿™äº›æ˜¯ <strong>NestJS</strong> å†…ç½®çš„ <strong>HTTP</strong> å¼‚å¸¸ç±»ï¼Œå®ƒä»¬ä¸ä¸Šé¢è‡ªå®šä¹‰å¼‚å¸¸ä¸€æ ·éƒ½æ˜¯ç»§æ‰¿è‡ª<strong>HttpException</strong>ã€‚</p><ul><li><code>BadRequestException</code></li><li><code>UnauthorizedException</code></li><li><code>NotFoundException</code></li><li><code>ForbiddenException</code></li><li><code>NotAcceptableException</code></li><li><code>RequestTimeoutException</code></li><li><code>ConflictException</code></li><li><code>GoneException</code></li><li><code>HttpVersionNotSupportedException</code></li><li><code>PayloadTooLargeException</code></li><li><code>UnsupportedMediaTypeException</code></li><li><code>UnprocessableEntityException</code></li><li><code>InternalServerErrorException</code></li><li><code>NotImplementedException</code></li><li><code>ImATeapotException</code></li><li><code>MethodNotAllowedException</code></li><li><code>BadGatewayException</code></li><li><code>ServiceUnavailableException</code></li><li><code>GatewayTimeoutException</code></li><li><code>PreconditionFailedException</code></li></ul><h3 id="åˆ›å»º-http-å¼‚å¸¸è¿‡æ»¤å™¨" tabindex="-1">åˆ›å»º HTTP å¼‚å¸¸è¿‡æ»¤å™¨ <a class="header-anchor" href="#åˆ›å»º-http-å¼‚å¸¸è¿‡æ»¤å™¨" aria-label="Permalink to &quot;åˆ›å»º HTTP å¼‚å¸¸è¿‡æ»¤å™¨&quot;">â€‹</a></h3><p>åˆ›å»ºå¼‚å¸¸è¿‡æ»¤å™¨æ¥æ¥ç®¡å†…ç½®çš„ <strong>å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨</strong> å®ç°ä½¿ç”¨ä¸åŒé¡¹ç›®çš„å¼‚å¸¸æ•è·å¤„ç†ï¼Œå¦‚å¢åŠ å¼‚å¸¸çš„æ—¥å¿—è®°å½•æˆ–æ”¹å˜ <strong>JSON</strong> æ¨¡å¼ã€‚</p><ol><li>åˆ›å»ºè¿‡æ»¤å™¨ï¼š <ul><li>å…¨å±€å‘½ä»¤ï¼š<code>nest generate filter &lt;filter-name&gt;</code></li><li>ç®€å†™å‘½ä»¤ï¼š<code>nest g f &lt;filter-name&gt;</code></li></ul></li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { ArgumentsHost, Catch, ExceptionFilter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> HttpExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> ExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ArgumentsHost</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol><li>é€šè¿‡<code>@Catch()</code> æŒ‡å®šé»˜è®¤åˆ›å»ºçš„è¿‡æ»¤å™¨ä¸ºæŒ‡å®šçš„ <code>HttpException</code> è¿‡æ»¤å™¨ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ArgumentsHost,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  Catch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ExceptionFilter,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  HttpException,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(HttpException)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> HttpExceptionFilter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> ExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> HttpException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ArgumentsHost</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(exception, host);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>é€šè¿‡æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡(<code>host</code>)ä¸­çš„ <strong>request</strong> è·å–å½“å‰è¯·æ±‚çš„åœ°å€ï¼Œå¼‚å¸¸å¯¹è±¡(<code>exception</code>)è·å–å½“å‰å¼‚å¸¸çŠ¶æ€ç ï¼Œå¹¶æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡(<code>host</code>)ä¸­é‡æ„ <strong>response</strong> å“åº”æ ¼å¼ï¼Œå®Œæˆå“åº”é‡æ„ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ArgumentsHost,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  Catch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ExceptionFilter,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  HttpException,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(HttpException)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> HttpExceptionFilter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> ExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> HttpException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ArgumentsHost</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> host.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">switchToHttp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> exception.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(status).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      statusCode: status,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      timestamp: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      path: request.url,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡Â  å°ç»“ï¼š</p><ol><li><code>exception</code> ä¸ºå½“å‰æ•è·åˆ°çš„å¼‚å¸¸å¯¹è±¡ï¼›</li><li><code>host</code> æ˜¯å½“å‰çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡ï¼›</li></ol><h3 id="ç»‘å®šè¿‡æ»¤å™¨" tabindex="-1">ç»‘å®šè¿‡æ»¤å™¨ <a class="header-anchor" href="#ç»‘å®šè¿‡æ»¤å™¨" aria-label="Permalink to &quot;ç»‘å®šè¿‡æ»¤å™¨&quot;">â€‹</a></h3><p>è·¯ç”±æ‰§è¡Œå‡½æ•°èŒƒå›´ç»‘å®šï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> HttpExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    await</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> ForbiddenException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;This is a custom message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(HttpExceptionFilter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    await</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> ForbiddenException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;This is a custom message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, error);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>æ§åˆ¶å™¨èŒƒå›´ç»‘å®šï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> HttpExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UseFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(HttpExceptionFilter)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> OrdersController</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><p>å…¨å±€èŒƒå›´ç»‘å®šï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> NestFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(AppModule);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">useGlobalFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> HttpExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  providers: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      provide: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">APP_FILTER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      useClass: HttpExceptionFilter,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> AppModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><h3 id="åˆ›å»ºé€šç”¨å¼‚å¸¸è¿‡æ»¤å™¨" tabindex="-1">åˆ›å»ºé€šç”¨å¼‚å¸¸è¿‡æ»¤å™¨ <a class="header-anchor" href="#åˆ›å»ºé€šç”¨å¼‚å¸¸è¿‡æ»¤å™¨" aria-label="Permalink to &quot;åˆ›å»ºé€šç”¨å¼‚å¸¸è¿‡æ»¤å™¨&quot;">â€‹</a></h3><p>åœ¨åˆ›å»º <strong>HTTP</strong> å¼‚å¸¸è¿‡æ»¤å™¨çš„æ—¶å€™ä½¿ç”¨ <code>@Catch()</code> è£…é¥°å™¨ç»‘å®šäº†ç‰¹å®šçš„ <code>HttpException</code>ï¼Œæ¥ä¸‹æ¥å°±åˆ›å»ºä¸€ä¸ªè„±ç¦»ç‰¹å®šå¼‚å¸¸ç±»ä¸”ä¸å¹³å°æ— å…³çš„é€šç”¨å¼‚å¸¸è¿‡æ»¤å™¨ã€‚</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// create commandï¼š\`nest g f all-exceptions\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ArgumentsHost,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  Catch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ExceptionFilter,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  HttpException,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  HttpStatus,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { HttpAdapterHost } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> AllExceptionsFilter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> ExceptionFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;"> httpAdapterHost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> HttpAdapterHost</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> unknown</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ArgumentsHost</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">httpAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.httpAdapterHost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> host.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">switchToHttp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> httpStatus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      exception </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> HttpException</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        ?</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> exception.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        :</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">INTERNAL_SERVER_ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> responseBody</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      statusCode: httpStatus,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      timestamp: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      path: httpAdapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getRequestUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    httpAdapter.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">reply</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(ctx.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(), responseBody, httpStatus);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ç»‘å®šé€šç”¨å¼‚å¸¸è¿‡æ»¤å™¨ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">httpAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(HttpAdapterHost);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">useGlobalFilters</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> AllExceptionsFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(httpAdapter));</span></span></code></pre></div><h2 id="ç®¡é“çš„ä½¿ç”¨" tabindex="-1">ç®¡é“çš„ä½¿ç”¨ <a class="header-anchor" href="#ç®¡é“çš„ä½¿ç”¨" aria-label="Permalink to &quot;ç®¡é“çš„ä½¿ç”¨&quot;">â€‹</a></h2><p>ç®¡é“æœ‰ä¸¤ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯ï¼Œå…¶ä¸€æ˜¯è½¬æ¢(å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºæ‰€éœ€è¦çš„å½¢å¼ï¼Œå¦‚ï¼Œå°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ç±»å‹)ï¼Œå…¶äºŒæ˜¯æ ¡éªŒ(æ ¡éªŒä¼ å…¥æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼Œæ— æ•ˆæ—¶å°†æŠ›å‡ºå¼‚å¸¸)æ•°æ®æ˜¯å¦æœ‰æ•ˆã€‚å› æ­¤ç®¡é“å°†è¿è¡Œåœ¨è·¯ç”±å¤„ç†å‡½æ•°çš„ <code>arguments</code> ä¸Šã€‚</p><h3 id="ç»‘å®šç®¡é“" tabindex="-1">ç»‘å®šç®¡é“ <a class="header-anchor" href="#ç»‘å®šç®¡é“" aria-label="Permalink to &quot;ç»‘å®šç®¡é“&quot;">â€‹</a></h3><p>NestJs æä¾›äº† 9 ä¸ªå¼€ç®±å³ç”¨çš„å†…ç½®ç®¡é“(<code>ValidationPipe</code>ï¼Œ<code>ParseIntPipe</code>ï¼Œ<code>ParseFloatPipe</code>ï¼Œ<code>ParseBoolPipe</code>ï¼Œ<code>ParseArrayPipe</code>ï¼Œ<code>ParseUUIDPipe</code>ï¼Œ<code>ParseEnumPipe</code>ï¼Œ<code>DefaultValuePipe</code>ï¼Œ<code>ParseFilePipe</code>)ï¼Œæ¥ç€å°±å°è¯•ç»‘å®š <code>ParseIntPipe</code> åˆ° <code>findOne</code> å¤„ç†å‡½æ•° å‡½æ•°ï¼Œè· <strong>number</strong> ç±»å‹ çš„ <code>id</code> å‚æ•°ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;:id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, ParseIntPipe) id: number) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> id); </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// number</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>å¦‚æœä¼ é€’çš„å‚æ•°æ— æ³•è½¬æ¢ä¸ºæ•°å­—åˆ™æŠ›å‡ºå¦‚ä¸‹çš„å¼‚å¸¸ï¼š</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;statusCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;2023-12-09T14:42:20.014Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/orders/a&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>é€šè¿‡å®ä¾‹åŒ– <code>ParseIntPipe</code> å¯¹è±¡å®šä¹‰è½¬æ¢å¤±è´¥åçš„é”™è¯¯ç ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;:id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">      &#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">      new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> ParseIntPipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        errorHttpStatusCode: HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">NOT_ACCEPTABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    id: number,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> id); </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// number</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span></code></pre></div><h3 id="åŸºäº-schema-çš„éªŒè¯" tabindex="-1">åŸºäº schema çš„éªŒè¯ <a class="header-anchor" href="#åŸºäº-schema-çš„éªŒè¯" aria-label="Permalink to &quot;åŸºäº schema çš„éªŒè¯&quot;">â€‹</a></h3><p><strong>zod</strong> æ˜¯ç”¨æ¥å®šä¹‰ <strong>schema</strong> å’Œ è¿›è¡ŒéªŒè¯çš„æ¨¡å—ï¼ŒåŸºäºç®¡é“å¯ä»¥å¾ˆå¥½çš„æ—¶é—´è·¯ç”±å¤„ç†å‡½æ•°å‚æ•°çš„éªŒè¯ï¼š</p><ol><li>å®‰è£… <strong>zod</strong>ï¼š<code>npm install --save zod</code> ï¼›</li><li>åˆ›å»ºç®¡é“ï¼š<code>nest generate pipe zod-validation</code> or <code>nest g pi zod-validation</code>ï¼›</li><li>å®Œå–„ç®¡é“ï¼šåˆ©ç”¨æ³¨å…¥çš„<code>ZodObject</code> è§£æå‚æ•°æ•°æ®æ ¼å¼ï¼›</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ArgumentMetadata,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  BadRequestException,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  Injectable,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  PipeTransform,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { ZodObject } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;zod&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ZodValidationPipe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> PipeTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">private</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;"> schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ZodObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">metadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ArgumentMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.schema.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(value);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">      throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> BadRequestException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;Validation failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol><li>å®šä¹‰ schemaï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { z } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;zod&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> createOrderSchema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> z</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    orderId: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    orderNo: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    orderName: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    orderStatus: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    orderAmount: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    createTime: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">date</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    updateTime: z.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">date</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">required</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> CreateOrderDto</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> z</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">infer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> createOrderSchema&gt;;</span></span></code></pre></div><ol><li>ç»‘å®šç®¡é“ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">UsePipes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> ZodValidationPipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(createOrderSchema))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() createOrderDto: CreateOrderDto) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(createOrderDto);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="åŸºäº-class-çš„éªŒè¯" tabindex="-1">åŸºäº class çš„éªŒè¯ <a class="header-anchor" href="#åŸºäº-class-çš„éªŒè¯" aria-label="Permalink to &quot;åŸºäº class çš„éªŒè¯&quot;">â€‹</a></h3><p>åœ¨ <strong>NestJS</strong> ä¸­å¯ä»¥ä½¿ç”¨ <strong>class-validator</strong> æ¨¡å—å®ç°åŸºäºç±»å’Œè£…é¥°å™¨çš„å½¢å¼è¿›è¡Œå‚æ•°éªŒè¯ã€‚</p><ol><li>å®‰è£… <strong>class-validator</strong>ï¼š<code>npm i --save class-validator class-transformer</code> ;</li><li>åˆ›å»ºç®¡é“ï¼š<code>nest generate pipe validation</code> or <code>nest g pi validation</code>ï¼›</li><li>å®Œå–„ç®¡é“ï¼šåˆ©ç”¨ <code>metatype</code> æä¾›çš„å‚æ•°å…ƒç±»å‹éªŒè¯å‚æ•°ï¼›</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ArgumentMetadata,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  BadRequestException,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  Injectable,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  PipeTransform,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@nestjs/common&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { validate } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;class-validator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { plainToInstance } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;class-transformer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Injectable</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ValidationPipe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> PipeTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, { </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">metatype</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> ArgumentMetadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">metatype </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">||</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">toValidate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(metatype)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> object</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> plainToInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(metatype, value);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> errors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> validate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(object);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (errors.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">      throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> BadRequestException</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;Validation failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> toValidate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">metatype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> types</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [String, Number, Date];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">types.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(metatype);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol><li>é‡æ–°ç»‘å®šç®¡é“ï¼š</li></ol><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> ValidationPipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()) createOrderDto: CreateOrderDto) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.ordersService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(createOrderDto);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ğŸ’¡ å…¨å±€ç»‘å®šç®¡é“ï¼š</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> NestFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(AppModule);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">useGlobalPipes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> ValidationPipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// or</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  providers: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      provide: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">APP_PIPE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      useClass: ValidationPipe,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> AppModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {}</span></span></code></pre></div><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h2><p>æœ¬ç¯‡æ–‡ç« ä»‹ç»äº† Nestjs çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬åˆ›å»ºé¡¹ç›®å’Œæ¨¡å—ï¼Œæ§åˆ¶å™¨ã€æœåŠ¡ã€æ¨¡å—ã€ä¸­é—´ä»¶ã€å¼‚å¸¸è¿‡æ»¤å™¨ã€ç®¡é“ã€å®ˆå«å’Œæ‹¦æˆªå™¨çš„ä½¿ç”¨ã€‚æ§åˆ¶å™¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡å°è£…å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¨¡å—ç®¡ç†æ‰€æœ‰æ§åˆ¶å™¨å’Œæä¾›è€…ï¼Œä¸­é—´ä»¶æ›´æ”¹è¯·æ±‚å“åº”å¯¹è±¡ï¼Œå¼‚å¸¸è¿‡æ»¤å™¨å¤„ç†æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸ï¼Œç®¡é“å¯¹å®¢æˆ·ç«¯æ•°æ®è¿›è¡Œè½¬æ¢å’ŒéªŒè¯ï¼Œå®ˆå«æ ¹æ®ç‰¹å®šçš„æƒé™è§’è‰²å†³å®šæ˜¯å¦è¿›è¡Œå¤„ç†ï¼Œæ‹¦æˆªå™¨å¯¹å¤„ç†å‡½æ•°è¿›è¡Œåˆ‡é¢ä¸Šçš„æ‰©å±•ã€‚</p>`,206);function B(s,E,u,m,b,v){const h=p,l=e("ClientOnly");return t(),r("div",null,[c,d(l,null,{default:g(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(t(),y(h,{key:0,article:s.$frontmatter},null,8,["article"])):D("",!0)]}),_:1}),F])}const T=k(C,[["render",B]]);export{O as __pageData,T as default};
